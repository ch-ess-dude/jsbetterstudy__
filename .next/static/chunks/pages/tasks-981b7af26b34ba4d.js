(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[782],{106:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(7876),r=a(3779);function i(e){let{children:t}=e;return(0,s.jsxs)("div",{className:"min-h-screen flex bg-white",children:[(0,s.jsx)(r.A,{}),(0,s.jsx)("main",{className:"flex-1 p-6 bg-gray-50",children:t})]})}},1914:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(7876),r=a(106),i=a(8537),n=a(4238),l=a(4232),c=a(5994);function d(){let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)(""),[i,n]=(0,l.useState)(!0),[d,o]=(0,l.useState)(null);async function u(e){if(e.preventDefault(),!a.trim())return;if(!d)return alert("Please sign in to save tasks");let s={user_id:d.id,title:a.trim(),completed:!1},{data:i,error:n}=await c.N.from("tasks").insert(s).select().single();if(n)return console.error("insert task",n);t(e=>[i,...e]),r("")}async function m(e,a){if(!d)return alert("Please sign in to update tasks");let{data:s,error:r}=await c.N.from("tasks").update({completed:!a}).eq("id",e).select().single();if(r)return console.error("update task",r);t(t=>t.map(t=>t.id===e?s:t));try{await h(d.id)}catch(e){console.error(e)}}async function f(e){if(!d)return alert("Please sign in to delete tasks");let{error:a}=await c.N.from("tasks").delete().eq("id",e);if(a)return console.error("delete task",a);t(t=>t.filter(t=>t.id!==e));try{await h(d.id)}catch(e){console.error(e)}}async function h(e){let{data:t}=await c.N.from("tasks").select("id,completed").eq("user_id",e),a=(t||[]).filter(e=>e.completed).length,s=(t||[]).filter(e=>!e.completed).length,r=new Date().toISOString().slice(0,10),{data:i}=await c.N.from("analytics").select("*").eq("user_id",e).eq("date",r).limit(1).single().catch(()=>({data:null}));i&&i.id?await c.N.from("analytics").update({tasks_completed:a,tasks_left:s}).eq("id",i.id):await c.N.from("analytics").insert({user_id:e,date:r,study_time_seconds:0,sessions_completed:0,tasks_completed:a,tasks_left:s})}return((0,l.useEffect)(()=>{let e=!0;return(async()=>{let{data:a}=await c.N.auth.getUser(),s=(null==a?void 0:a.user)||null;if(!e)return;if(o(s),!s)return n(!1);let{data:r,error:i}=await c.N.from("tasks").select("*").eq("user_id",s.id).order("created_at",{ascending:!1});i?console.error("fetch tasks",i):t(r||[]),n(!1)})(),()=>{e=!1}},[]),i)?(0,s.jsx)("div",{className:"p-4 bg-white rounded shadow",children:"Loading tasks..."}):d?(0,s.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:[(0,s.jsxs)("form",{onSubmit:u,className:"flex gap-2",children:[(0,s.jsx)("input",{value:a,onChange:e=>r(e.target.value),placeholder:"New task",className:"flex-1 border p-2 rounded"}),(0,s.jsx)("button",{className:"btn-primary",children:"Add"})]}),(0,s.jsxs)("ul",{className:"mt-4 space-y-2",children:[0===e.length&&(0,s.jsx)("li",{className:"text-zinc-500",children:"No tasks yet."}),e.map(e=>(0,s.jsxs)("li",{className:"flex items-center justify-between border p-2 rounded",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:e.completed,onChange:()=>m(e.id,e.completed)}),(0,s.jsx)("span",{className:e.completed?"line-through text-zinc-400":"",children:e.title})]})}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)("button",{onClick:()=>f(e.id),className:"text-sm text-red-600",children:"Delete"})})]},e.id))]})]}):(0,s.jsx)("div",{className:"p-4 bg-white rounded shadow",children:"Please sign in to sync your tasks with the database."})}function o(){let{loading:e}=(0,i.A)(),{tasks:t,loading:a,createTask:l,updateTask:c,deleteTask:o}=(0,n.A)();return e?(0,s.jsx)("div",{children:"Loading..."}):(0,s.jsxs)(r.A,{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Tasks"}),(0,s.jsx)("p",{className:"text-zinc-600 mt-2",children:"Create and manage your to-dos here."}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(d,{tasks:t,loading:a,createTask:l,updateTask:c,deleteTask:o})})]})}},3124:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/tasks",function(){return a(1914)}])},4238:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(4232),r=a(5994);function i(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0);async function n(a,s){let i=e.find(e=>e.id===a);t(e=>e.map(e=>e.id===a?{...e,...s}:e));try{let{data:e,error:i}=await r.N.from("tasks").update(s).eq("id",a).select().single();if(i)throw i;return t(t=>t.map(t=>t.id===a?e:t)),e}catch(e){throw console.error("updateTask error",e),t(e=>e.map(e=>e.id===a?i:e)),e}}async function l(a){t(e=>e.filter(e=>e.id!==a));try{let{error:e}=await r.N.from("tasks").delete().eq("id",a);if(e)throw e;return!0}catch(a){throw console.error("deleteTask error",a),t(e),a}}return(0,s.useEffect)(()=>{let e=!0;return async function(){i(!0);try{let{data:a,error:s}=await r.N.from("tasks").select("*").order("created_at",{ascending:!1});if(s)throw s;e&&t(a||[])}catch(e){console.error("load tasks error",e)}finally{e&&i(!1)}}(),()=>{e=!1}},[]),{tasks:e,loading:a,createTask:async function(e){let a={id:"tmp_".concat(Date.now()),...e,created_at:new Date().toISOString()};t(e=>[a,...e]);try{let{data:s,error:i}=await r.N.from("tasks").insert(e).select().single();if(i)throw i;return t(e=>e.map(e=>e.id===a.id?s:e)),s}catch(e){throw console.error("createTask error",e),t(e=>e.filter(e=>e.id!==a.id)),e}},updateTask:n,deleteTask:l,refresh:async()=>{i(!0);let{data:e}=await r.N.from("tasks").select("*").order("created_at",{ascending:!1});t(e||[]),i(!1)}}}},8537:(e,t,a)=>{"use strict";a.d(t,{A:()=>n});var s=a(4232),r=a(5994),i=a(9099);function n(){let[e,t]=(0,s.useState)(!0),[a,n]=(0,s.useState)(null),l=(0,i.useRouter)();return(0,s.useEffect)(()=>{let e=!0;return async function(){let{data:a}=await r.N.auth.getUser();if(!e)return;let s=null==a?void 0:a.user;if(!s)return l.replace("/auth");try{var i,c,d;let e={id:s.id,email:s.email||null,name:(null==(i=s.user_metadata)?void 0:i.full_name)||(null==(c=s.user_metadata)?void 0:c.name)||null,avatar_url:(null==(d=s.user_metadata)?void 0:d.avatar_url)||null};await r.N.from("users").upsert(e,{returning:"minimal"})}catch(e){console.error("user upsert failed",e)}n(s),t(!1)}(),()=>{e=!1}},[]),{loading:e,user:a}}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(3124)),_N_E=e.O()}]);