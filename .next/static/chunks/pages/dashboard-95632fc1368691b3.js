(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[724],{106:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var d=t(7876),a=t(3779);function i(e){let{children:s}=e;return(0,d.jsxs)("div",{className:"min-h-screen flex bg-white",children:[(0,d.jsx)(a.A,{}),(0,d.jsx)("main",{className:"flex-1 p-6 bg-gray-50",children:s})]})}},3483:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var d=t(7876),a=t(4232),i=t(5994),l=t(106),n=t(8537);function c(){let[e,s]=(0,a.useState)({study_time_seconds:0,sessions_completed:0,tasks_completed:0,tasks_left:0}),[t,c]=(0,a.useState)(0),[r,o]=(0,a.useState)(!0),[u,m]=(0,a.useState)([]),{loading:h,user:_}=(0,n.A)();return((0,a.useEffect)(()=>{if(h)return},[h]),(0,a.useEffect)(()=>{(async()=>{if(!_)return o(!1);let{data:e}=await i.N.from("analytics").select("date,study_time_seconds, sessions_completed, tasks_completed, tasks_left").eq("user_id",_.id).order("date",{ascending:!0}).limit(365);s((e||[]).reduce((e,s)=>(e.study_time_seconds+=s.study_time_seconds||0,e.sessions_completed+=s.sessions_completed||0,e.tasks_completed+=s.tasks_completed||0,e.tasks_left+=s.tasks_left||0,e),{study_time_seconds:0,sessions_completed:0,tasks_completed:0,tasks_left:0})),m(e||[]);let t=new Date,d=new Date(t.setDate(t.getDate()-t.getDay())).toISOString().slice(0,10),{data:a}=await i.N.from("analytics").select("date,study_time_seconds").eq("user_id",_.id).gte("date",d);c(Math.min(100,Math.round((a||[]).reduce((e,s)=>e+(s.study_time_seconds||0),0)/36e3*100))),o(!1)})()},[_]),r||h)?(0,d.jsx)("div",{children:"Loading dashboard..."}):(0,d.jsx)(l.A,{children:(0,d.jsxs)("div",{children:[(0,d.jsx)("h2",{className:"text-2xl font-semibold",children:"Dashboard"}),(0,d.jsx)("p",{className:"text-zinc-600 mt-2",children:"Analytics overview and AI placeholders."}),(0,d.jsxs)("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:["Total study hours: ",(e.study_time_seconds/3600).toFixed(2)]}),(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:["Sessions completed: ",e.sessions_completed]}),(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:["Tasks completed: ",e.tasks_completed]}),(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow",children:["Tasks left: ",e.tasks_left]}),(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow col-span-1 md:col-span-2",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("div",{children:"Weekly progress"}),(0,d.jsxs)("div",{children:[t,"%"]})]}),(0,d.jsx)("div",{className:"w-full bg-zinc-200 h-3 rounded mt-2",children:(0,d.jsx)("div",{className:"bg-zinc-800 h-3 rounded",style:{width:"".concat(t,"%")}})})]}),(0,d.jsxs)("div",{className:"p-4 bg-white rounded shadow col-span-1 md:col-span-2",children:[(0,d.jsx)("h3",{className:"font-medium mb-2",children:"Recent analytics"}),(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:u.slice(-7).map(e=>(0,d.jsxs)("div",{className:"p-2 border rounded",children:[(0,d.jsx)("div",{className:"text-sm text-zinc-500",children:e.date}),(0,d.jsxs)("div",{className:"font-semibold",children:[(e.study_time_seconds/3600).toFixed(2)," hrs"]}),(0,d.jsxs)("div",{className:"text-xs text-zinc-500",children:["Sessions: ",e.sessions_completed]})]},e.date))})]})]})]})})}},5372:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(3483)}])},8537:(e,s,t)=>{"use strict";t.d(s,{A:()=>l});var d=t(4232),a=t(5994),i=t(9099);function l(){let[e,s]=(0,d.useState)(!0),[t,l]=(0,d.useState)(null),n=(0,i.useRouter)();return(0,d.useEffect)(()=>{let e=!0;return async function(){let{data:t}=await a.N.auth.getUser();if(!e)return;let d=null==t?void 0:t.user;if(!d)return n.replace("/auth");try{var i,c,r;let e={id:d.id,email:d.email||null,name:(null==(i=d.user_metadata)?void 0:i.full_name)||(null==(c=d.user_metadata)?void 0:c.name)||null,avatar_url:(null==(r=d.user_metadata)?void 0:r.avatar_url)||null};await a.N.from("users").upsert(e,{returning:"minimal"})}catch(e){console.error("user upsert failed",e)}l(d),s(!1)}(),()=>{e=!1}},[]),{loading:e,user:t}}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(5372)),_N_E=e.O()}]);