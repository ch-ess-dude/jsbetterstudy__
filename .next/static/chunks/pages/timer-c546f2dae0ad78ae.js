(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[123],{106:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(7876),r=s(3779);function l(e){let{children:t}=e;return(0,a.jsxs)("div",{className:"min-h-screen flex bg-white",children:[(0,a.jsx)(r.A,{}),(0,a.jsx)("main",{className:"flex-1 p-6 bg-gray-50",children:t})]})}},4238:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var a=s(4232),r=s(5994);function l(){let[e,t]=(0,a.useState)([]),[s,l]=(0,a.useState)(!0);async function n(s,a){let l=e.find(e=>e.id===s);t(e=>e.map(e=>e.id===s?{...e,...a}:e));try{let{data:e,error:l}=await r.N.from("tasks").update(a).eq("id",s).select().single();if(l)throw l;return t(t=>t.map(t=>t.id===s?e:t)),e}catch(e){throw console.error("updateTask error",e),t(e=>e.map(e=>e.id===s?l:e)),e}}async function i(s){t(e=>e.filter(e=>e.id!==s));try{let{error:e}=await r.N.from("tasks").delete().eq("id",s);if(e)throw e;return!0}catch(s){throw console.error("deleteTask error",s),t(e),s}}return(0,a.useEffect)(()=>{let e=!0;return async function(){l(!0);try{let{data:s,error:a}=await r.N.from("tasks").select("*").order("created_at",{ascending:!1});if(a)throw a;e&&t(s||[])}catch(e){console.error("load tasks error",e)}finally{e&&l(!1)}}(),()=>{e=!1}},[]),{tasks:e,loading:s,createTask:async function(e){let s={id:"tmp_".concat(Date.now()),...e,created_at:new Date().toISOString()};t(e=>[s,...e]);try{let{data:a,error:l}=await r.N.from("tasks").insert(e).select().single();if(l)throw l;return t(e=>e.map(e=>e.id===s.id?a:e)),a}catch(e){throw console.error("createTask error",e),t(e=>e.filter(e=>e.id!==s.id)),e}},updateTask:n,deleteTask:i,refresh:async()=>{l(!0);let{data:e}=await r.N.from("tasks").select("*").order("created_at",{ascending:!1});t(e||[]),l(!1)}}}},4942:(e,t,s)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/timer",function(){return s(5411)}])},5411:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(7876),r=s(106),l=s(8537),n=s(4232),i=s(5994),o=s(4238);let c={pomodoro:{label:"Pomodoro",minutes:25},short:{label:"Short Break",minutes:5},long:{label:"Long Break",minutes:15}};function d(){let{tasks:e,loading:t,updateTask:s}=(0,o.A)(),[r,l]=(0,n.useState)("Focus Session"),[d,u]=(0,n.useState)("pomodoro"),[m,f]=(0,n.useState)([]),[h,x]=(0,n.useState)([]),p=(0,n.useMemo)(()=>60*c[d].minutes,[d]),[g,w]=(0,n.useState)(p),[N,v]=(0,n.useState)(!1),_=(0,n.useRef)(null);async function y(){let{data:e}=await i.N.auth.getUser(),t=null==e?void 0:e.user;if(!t)return void alert("Please sign in to save sessions");let a=new Date(Date.now()-1e3*p).toISOString(),l=new Date().toISOString(),n={user_id:t.id,name:r,type:d,duration_seconds:p,start_ts:a,end_ts:l};try{var o,c,u,g;let{data:e,error:a}=await i.N.from("sessions").insert(n).select().single();if(a)throw a;if(m&&m.length>0){let t=m.map(t=>({session_id:e.id,task_id:t,status:"active"}));await i.N.from("session_tasks").insert(t)}let r=h||[];for(let e of r)try{await s(e,{completed:!0})}catch(e){console.error("task complete update err",e)}let l=new Date().toISOString().slice(0,10),{data:d}=await i.N.from("analytics").select("*").eq("user_id",t.id).eq("date",l).limit(1).single().catch(()=>({data:null})),N=r.length,v=(null==(o=(await i.N.from("tasks").select("id,completed").eq("user_id",t.id)).data)?void 0:o.filter(e=>!e.completed).length)||0;d&&d.id?await i.N.from("analytics").update({study_time_seconds:(d.study_time_seconds||0)+p,sessions_completed:(d.sessions_completed||0)+1,tasks_completed:(d.tasks_completed||0)+N,tasks_left:v}).eq("id",d.id):await i.N.from("analytics").insert({user_id:t.id,date:l,study_time_seconds:p,sessions_completed:1,tasks_completed:N,tasks_left:v}),f([]),x([]),w(p);try{null==(g=window)||null==(u=g.toast)||null==(c=u.success)||c.call(u,"Session saved")}catch(e){}}catch(e){console.error("session save error",e),alert("Error saving session: "+e.message)}}return(0,n.useEffect)(()=>{w(p)},[p]),(0,n.useEffect)(()=>(N?_.current=setInterval(()=>w(e=>e-1),1e3):clearInterval(_.current),()=>clearInterval(_.current)),[N]),(0,n.useEffect)(()=>{g<=0&&N&&(v(!1),y())},[g,N]),(0,a.jsxs)("div",{className:"max-w-3xl mx-auto bg-gradient-to-b from-white to-gray-50 p-6 rounded-2xl shadow-lg",children:[(0,a.jsxs)("header",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{value:r,onChange:e=>l(e.target.value),className:"w-full p-3 rounded-lg border"})}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:Object.keys(c).map(e=>(0,a.jsx)("button",{onClick:()=>u(e),className:"px-3 py-2 rounded ".concat(d===e?"bg-blue-600 text-white":"bg-white text-gray-700"," shadow-sm"),children:c[e].label},e))})]}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-6",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-56 h-56 rounded-full bg-gradient-to-tr from-white to-indigo-50 flex items-center justify-center shadow-inner",children:(0,a.jsx)("div",{className:"text-5xl font-mono",children:function(e){let t=Math.floor(e/60).toString().padStart(2,"0"),s=Math.floor(e%60).toString().padStart(2,"0");return"".concat(t,":").concat(s)}(Math.max(0,g))})}),(0,a.jsxs)("div",{className:"mt-4 flex gap-3",children:[N?(0,a.jsx)("button",{onClick:()=>v(!1),className:"px-4 py-2 bg-yellow-400 text-white rounded",children:"Pause"}):(0,a.jsx)("button",{onClick:()=>v(!0),className:"btn-primary",children:"Start"}),(0,a.jsx)("button",{onClick:()=>{v(!1),w(p)},className:"px-4 py-2 bg-gray-200 rounded",children:"Reset"})]})]}),(0,a.jsxs)("aside",{className:"w-full md:w-80 bg-white p-4 rounded-lg shadow",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"Attach Tasks"}),t?(0,a.jsx)("div",{className:"text-sm text-zinc-500",children:"Loading tasks..."}):(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-3",children:[e.map(e=>(0,a.jsxs)("label",{className:"flex items-center gap-2 p-2 rounded hover:bg-gray-50",children:[(0,a.jsx)("input",{type:"checkbox",checked:m.includes(e.id),onChange:()=>{var t;return t=e.id,void f(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"font-medium ".concat(e.completed?"line-through text-gray-400":""),children:e.title||e.name||e.description||"Task"}),(0,a.jsx)("div",{className:"text-xs text-zinc-500",children:e.notes||""})]}),(0,a.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:()=>{var t;return t=e.id,void x(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},title:"Mark completed after session"})]},e.id)),0===e.length&&(0,a.jsx)("div",{className:"text-sm text-zinc-500",children:"No tasks yet"})]})]})]}),(0,a.jsxs)("footer",{className:"mt-6 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{l("Focus Session"),f([]),x([]),u("pomodoro"),w(60*c.pomodoro.minutes)},className:"px-3 py-2 bg-white rounded shadow",children:"Add New Session"}),(0,a.jsx)("button",{onClick:()=>y(),className:"px-3 py-2 bg-green-600 text-white rounded",children:"Save Session"})]}),(0,a.jsxs)("div",{className:"text-sm text-zinc-500",children:["Mode: ",c[d].label," â€¢ ",c[d].minutes," min"]})]})]})}function u(){let{loading:e}=(0,l.A)();return e?(0,a.jsx)("div",{children:"Loading..."}):(0,a.jsxs)(r.A,{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"Timer"}),(0,a.jsx)(d,{})]})}},8537:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});var a=s(4232),r=s(5994),l=s(9099);function n(){let[e,t]=(0,a.useState)(!0),[s,n]=(0,a.useState)(null),i=(0,l.useRouter)();return(0,a.useEffect)(()=>{let e=!0;return async function(){let{data:s}=await r.N.auth.getUser();if(!e)return;let a=null==s?void 0:s.user;if(!a)return i.replace("/auth");try{var l,o,c;let e={id:a.id,email:a.email||null,name:(null==(l=a.user_metadata)?void 0:l.full_name)||(null==(o=a.user_metadata)?void 0:o.name)||null,avatar_url:(null==(c=a.user_metadata)?void 0:c.avatar_url)||null};await r.N.from("users").upsert(e,{returning:"minimal"})}catch(e){console.error("user upsert failed",e)}n(a),t(!1)}(),()=>{e=!1}},[]),{loading:e,user:s}}}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(4942)),_N_E=e.O()}]);